import{x as I,s as R,a as A,u as M,r as u,y as L,c as P,o as q,b as z,p as l,e as i,g as o,R as b,i as w,f as k,t as C,A as F,F as K,q as T,l as H,v as U,j as V}from"./index-EqsJQukp.js";const J={class:"min-h-screen flex"},W={class:"flex-1 flex items-center justify-center px-4 sm:px-6 lg:px-8 bg-white"},Y={class:"max-w-md w-full space-y-8"},G={class:"text-center"},O={class:"text-center"},Q={class:"font-semibold text-gray-900"},X={class:"flex space-x-2"},Z=["onUpdate:modelValue","onInput","onKeydown"],$=["disabled"],ee={key:0,class:"flex items-center justify-center"},te={key:1},oe={class:"text-center space-y-4"},se=["disabled"],ae={key:0},le={key:1},ie={key:2},ne={class:"text-center"},de={__name:"verify-email",setup(re){const g=I(),h=R(),f=A(),_=M(),v=u(!1),p=u(!1),c=u(0),m=u(h.query.email||""),y=u(h.query.role||"no role"),n=L(["","","","","",""]),x=u([]),S=P(()=>n.every(e=>e!=="")),N=(e,t)=>{var a;t.target.value&&e<5&&((a=x.value[e+1])==null||a.focus())},j=(e,t)=>{var s;t.key==="Backspace"&&!n[e]&&e>0&&((s=x.value[e-1])==null||s.focus())},E=e=>{e.preventDefault();const s=e.clipboardData.getData("text").replace(/\D/g,"").slice(0,6);for(let a=0;a<s.length;a++)n[a]=s[a]},B=async()=>{v.value=!0;try{const e=n.join("");console.log("Verification code entered:",e),console.log("Email:",m.value),console.log("Role:",y.value);const t={email:m.value,code:e,otp:e,verificationCode:e,role:y.value};console.log("Sending verification data:",t),console.log("calling authStore.verifyEmail...");const s=await _.verifyEmail(t);if(console.log("Received result from authStore.verifyEmail:",s),s.success)f.addNotification({type:"success",title:"Email verified!",message:"Your account has been successfully verified."}),(y==="student"||y==="sponsor")&&g.push();else throw f.addNotification({type:"error",title:"Email verification failed",message:s.error||"An error occurred during registration"}),new Error(s.error);g.push("/auth/login")}catch{f.addNotification({type:"error",title:"Verification failed",message:"Invalid verification code. Please try again."})}finally{v.value=!1}},D=async()=>{p.value=!0;try{const e={email:m.value},t=await _.resendVerificationCode(e);f.addNotification({type:"success",title:"Code sent!",message:"A new verification code has been sent to your email."}),c.value=60;const s=setInterval(()=>{c.value--,c.value<=0&&clearInterval(s)},1e3)}catch{f.addNotification({type:"error",title:"Failed to resend",message:"Could not send verification code. Please try again."})}finally{p.value=!1}};return q(()=>{var e;(e=x.value[0])==null||e.focus()}),(e,t)=>{const s=z("router-link");return i(),l("div",J,[o("div",W,[o("div",Y,[o("div",G,[w(s,{to:"/",class:"inline-flex items-center space-x-2"},{default:k(()=>t[0]||(t[0]=[o("div",{class:"w-12 h-12 bg-coral-500 rounded-xl flex items-center justify-center"},[o("span",{class:"text-white font-bold text-xl"},"L")],-1),o("span",{class:"text-2xl font-bold text-gray-900"},"Lnaid",-1)])),_:1,__:[0]})]),o("div",O,[t[1]||(t[1]=b('<div class="w-16 h-16 bg-coral-100 rounded-full flex items-center justify-center mx-auto mb-4"><svg class="w-8 h-8 text-coral-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg></div><h2 class="text-3xl font-bold text-gray-900">Verify your email</h2><p class="mt-2 text-gray-600">We&#39;ve sent a verification code to</p>',3)),o("p",Q,C(m.value),1)]),o("form",{onSubmit:F(B,["prevent"]),class:"mt-8 space-y-6"},[o("div",null,[t[2]||(t[2]=o("label",{for:"code",class:"form-label"},"Verification Code",-1)),o("div",X,[(i(!0),l(K,null,T(n,(a,d)=>H((i(),l("input",{key:d,ref_for:!0,ref:r=>x.value[d]=r,"onUpdate:modelValue":r=>n[d]=r,type:"text",maxlength:"1",class:"w-12 h-12 text-center text-xl font-bold border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-coral-500 focus:border-coral-500",onInput:r=>N(d,r),onKeydown:r=>j(d,r),onPaste:E},null,40,Z)),[[U,n[d]]])),128))])]),o("div",null,[o("button",{type:"submit",disabled:v.value||!S.value,class:"w-full btn-primary"},[v.value?(i(),l("span",ee,t[3]||(t[3]=[o("svg",{class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[o("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),o("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),V(" Verifying... ")]))):(i(),l("span",te,"Verify Email"))],8,$)]),o("div",oe,[t[4]||(t[4]=o("p",{class:"text-sm text-gray-600"},"Didn't receive the code?",-1)),o("button",{type:"button",onClick:D,disabled:p.value||c.value>0,class:"text-coral-500 hover:text-coral-600 font-medium text-sm"},[p.value?(i(),l("span",ae,"Sending...")):c.value>0?(i(),l("span",le," Resend in "+C(c.value)+"s ",1)):(i(),l("span",ie,"Resend verification code"))],8,se)]),o("div",ne,[w(s,{to:"/auth/login",class:"text-sm text-gray-600 hover:text-coral-500"},{default:k(()=>t[5]||(t[5]=[V(" ‚Üê Back to login ")])),_:1,__:[5]})])],32)])]),t[6]||(t[6]=b('<div class="hidden lg:block lg:flex-1 bg-gradient-to-br from-coral-500 to-coral-600"><div class="flex items-center justify-center h-full p-12"><div class="text-center text-white"><h2 class="text-4xl font-bold mb-6">Almost There!</h2><p class="text-xl text-coral-100 mb-8"> Just one more step to secure your account and start your educational journey. </p></div></div></div>',1))])}}};export{de as default};
